{% extends '../../layout.html' %}
{% block content %}
<!-- END OF BREADCRUMBS -->
<div class="row" id="productApp">
    <div class="col-xs-12">
        <div class="panel panel-default shadow">
            <div class="panel-heading clearfix">
                <h4 class="panel-title">商品列表</h4>
                <div class="panel-control">
                    <button type="button" @click="showModal" class="v-add-student btn btn-info btn-sm">
                        <i class="fa fa-plus m-r-xxs"></i>添加商品
                    </button>
                </div>
            </div>
            <div class="panel-body">
                <div class="m-t-sm m-l-sm" v-show="!loading && products.length === 0">
                    <span>提示：当前商城没有任何商品，请点击 [添加商品] 创建商品列表！</span>
                </div>
                <div class="alert-2 alert-warning-2">
                    备注：微信端积分商城会根据积分数自动排序，设置时可以不用考虑顺序问题。
                </div>
                <ul class="cd-gallery" id="product-list">
                    <Loading :loading="loading"></Loading>
                    <product-item v-for="product in products | orderBy 'score' -1 "
                                  :product="product"
                                  :index="$index"
                                  @delete-product="deleteProduct">
                    </product-item>
                </ul>
            </div>
        </div>
    </div>
    <product-modal v-ref:modal @add-product="addProduct"></product-modal>
</div>

<script type="x/template" id="productTemplate">
    <li>
        <div class="cd-item-img">
            <a href="javascript:void(0)">
                <img class="lazy center-block" :src="product.imageKey | visit">
            </a>
        </div>
        <div class="cd-item-info">
            <b> {{product.productName}}</b>
            <b class="cd-price">积分 {{product.score}}</b>
        </div>
        <div class="cd-item-details">
            <div class="pull-left m-t-xs m-l-sm f-gray">
                数量{{product.stock}}
            </div>
            <a class="pull-right delete-btn" @click="delete"><span class="f-info">删除</span></a>
            <a class="pull-right edit-btn" @click="edit"><span class="f-info">修改</span></a>
        </div>
    </li>
</script>

<script type="x/template" id="productModal">
    <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">商品信息</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal m-t-sm" id="productForm" name="productForm">
                        <div class="form-group">
                            <label for="productName" class="col-xs-3 control-label">商品名称：</label>
                            <div class="col-xs-8">
                                <input class="form-control validate" type="text" v-model="productName">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="stock" class="col-xs-3 control-label">商品数量：</label>

                            <div class="col-xs-8">
                                <input class="form-control validate" type="text" v-model="stock">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-3 control-label" for="score">兑换积分：</label>
                            <div class="col-xs-8">
                                <input class="form-control validate" type="text" v-model="score">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-3 control-label">商品图片：</label>
                            <div class="col-xs-8">
                                <input type="file" id="imageUpload">
                                <div class="pro-image-frame m-t-md">

                                    <img class="b"
                                         v-if="!imageKey || imageKey ===''"
                                         src="/images/coverpage_default.png"
                                         width="240px"
                                         height="160px">

                                    <img class="b"
                                         v-if="imageKey && imageKey !== ''"
                                         :src="imageKey | visit"
                                         width="240px"
                                         height="160px">
                                </div>
                                <input type="hidden" name="imageKey" id="imageKey"
                                       v-model="imageKey"
                                       class="form-control validate"
                                       data-display="图片">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-offset-3 col-xs-8">
                                <button type="button" class="btn btn-info" @click="add">确定</button>
                                <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</script>
{% endblock %}

{% block javascript %}
<script src="/js/entries/school/scores/list-products.js"></script>

{% endblock %}
